# Load the KernSmooth package (install if not available)
if (!requireNamespace("KernSmooth", quietly = TRUE)) {
  install.packages("KernSmooth")
}
library(KernSmooth)

# Load the built-in mtcars dataset
data(mtcars)

# Extract variables
x <- mtcars$hp   # Predictor: Horsepower
y <- mtcars$mpg  # Response: Miles per Gallon

# Select optimal bandwidth using dpill
bw <- dpill(x, y)

# Perform Nadaraya–Watson kernel regression using locpoly
fit <- locpoly(x, y, bandwidth = bw, degree = 0, kernel = "normal", gridsize = 100)

# Visualize the result
plot(x, y,
     main = "Nadaraya–Watson Estimation",
     xlab = "Horsepower",
     ylab = "Miles per Gallon",
     pch = 19)
lines(fit, col = "blue")  # Add the fitted regression curve
        
