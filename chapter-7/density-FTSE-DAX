library(datasets)
library(ks)

# Load the EuStockMarkets dataset
data("EuStockMarkets")

# Extract the FTSE (UK) and DAX (Germany) index series
ftse_prices <- EuStockMarkets[, "FTSE"]
dax_prices <- EuStockMarkets[, "DAX"]

# Compute daily returns as percentage changes
ftse_returns <- diff(ftse_prices) / lag(ftse_prices, -1) * 100
dax_returns <- diff(dax_prices) / lag(dax_prices, -1) * 100

# Remove NA values generated by diff()
ftse_returns <- na.omit(ftse_returns)
dax_returns <- na.omit(dax_returns)

# Combine both return series into a data frame
market_returns <- data.frame(FTSE_Returns = ftse_returns, DAX_Returns = dax_returns)

# Convert the data frame to a matrix for multivariate analysis
data_matrix <- as.matrix(market_returns)

# Perform multivariate kernel density estimation using the ks package
kde_result <- kde(x = data_matrix)

# 2D visualization using filled contour plot
plot(kde_result, display = "filled.contour")

# 3D visualization using perspective plot
plot(kde_result, display = "persp")
